(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{727:(e,a,t)=>{Promise.resolve().then(t.bind(t,2482))},2482:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>v});var n=t(5155),s=t(2115);let o={nuevo:"bg-slate-100 text-slate-700",contactado:"bg-botanical-100 text-botanical-700",seguimiento:"bg-amber-100 text-amber-700",llamada:"bg-violet-100 text-violet-700",venta:"bg-emerald-100 text-emerald-700",no_interesado:"bg-rose-100 text-rose-700",cerrado_tiempo:"bg-slate-200 text-slate-700"},l={nuevo:"Nuevo",contactado:"Contactado",seguimiento:"En seguimiento",llamada:"Llamada realizada",venta:"Venta efectiva",no_interesado:"No interesado",cerrado_tiempo:"Cerrado por tiempo"};function i(e){let{status:a}=e;return(0,n.jsx)("span",{className:"inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ".concat(o[a]),children:l[a]})}function d(e){var a;let{lead:t,onChangeStatus:s,onCloseLead:o,onSimulateCall:l,lastCallNote:d,history:r,slaDaysRemaining:c,isSlaBreached:x,errorMessage:m}=e;return t?(0,n.jsxs)("div",{className:"flex flex-col gap-6 rounded-2xl border border-botanical-100 bg-white p-6 shadow-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-botanical-500",children:"Detalle del lead"}),(0,n.jsx)("h2",{className:"mt-2 text-2xl font-semibold text-botanical-900",children:null!==(a=t.nombre)&&void 0!==a?a:"Sin nombre"}),(0,n.jsx)("p",{className:"text-sm text-botanical-600",children:t.telefono})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,n.jsx)(i,{status:t.estadoActual}),(0,n.jsxs)("span",{className:"text-xs text-botanical-600",children:["\xdaltima actualizaci\xf3n: ",new Date(t.fechaEstado).toLocaleDateString()]}),(0,n.jsxs)("span",{className:"text-xs font-semibold ".concat(x?"text-rose-600":"text-botanical-600"),children:["SLA: ",x?"Vencido":"".concat(c," d\xedas")]})]}),(0,n.jsxs)("div",{className:"grid gap-4 text-sm text-botanical-700 sm:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-botanical-500",children:"Pa\xeds"}),(0,n.jsx)("p",{className:"mt-2 font-semibold text-botanical-900",children:t.pais})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-botanical-500",children:"Agente"}),(0,n.jsx)("p",{className:"mt-2 font-semibold text-botanical-900",children:t.agenteId})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-botanical-500",children:"Administrador"}),(0,n.jsx)("p",{className:"mt-2 font-semibold text-botanical-900",children:t.administradorId})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-botanical-500",children:"Creaci\xf3n"}),(0,n.jsx)("p",{className:"mt-2 font-semibold text-botanical-900",children:new Date(t.createdAt).toLocaleDateString()})]})]}),(0,n.jsxs)("div",{className:"grid gap-3",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-botanical-700",children:"Cambiar estado"}),(0,n.jsxs)("select",{value:t.estadoActual,onChange:e=>s(e.target.value),className:"rounded-xl border border-botanical-100 px-3 py-2 text-sm text-botanical-800 focus:border-botanical-400 focus:outline-none focus:ring-2 focus:ring-botanical-100",children:[(0,n.jsx)("option",{value:"nuevo",children:"Nuevo"}),(0,n.jsx)("option",{value:"contactado",children:"Contactado"}),(0,n.jsx)("option",{value:"seguimiento",children:"En seguimiento"}),(0,n.jsx)("option",{value:"llamada",children:"Llamada realizada"}),(0,n.jsx)("option",{value:"venta",children:"Venta efectiva"}),(0,n.jsx)("option",{value:"no_interesado",children:"No interesado"}),(0,n.jsx)("option",{value:"cerrado_tiempo",children:"Cerrado por tiempo"})]}),m?(0,n.jsx)("p",{className:"text-xs text-rose-600",children:m}):null]}),(0,n.jsx)("button",{type:"button",onClick:o,className:"w-full rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-soft transition hover:bg-emerald-700",children:"Cerrar lead (venta efectiva)"}),(0,n.jsx)("div",{className:"rounded-2xl border border-botanical-100 bg-botanical-50 p-4 text-sm text-botanical-700",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-botanical-500",children:"\xdaltima llamada (simulada)"}),(0,n.jsx)("p",{className:"mt-2 text-sm font-semibold text-botanical-900",children:null!=d?d:"Sin llamadas registradas"})]}),(0,n.jsx)("button",{type:"button",onClick:l,className:"rounded-xl border border-botanical-200 bg-white px-3 py-2 text-xs font-semibold text-botanical-700 shadow-sm transition hover:bg-botanical-100",children:"Simular llamada"})]})}),(0,n.jsxs)("div",{className:"rounded-2xl border border-botanical-100 bg-white p-4",children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-botanical-500",children:"Historial de estados"}),(0,n.jsx)("div",{className:"mt-3 space-y-2 text-xs text-botanical-700",children:0===r.length?(0,n.jsx)("div",{className:"rounded-xl border border-dashed border-botanical-200 bg-botanical-50 p-3 text-botanical-600",children:"Sin historial registrado."}):r.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{children:e.estado}),(0,n.jsx)("span",{className:"text-botanical-500",children:new Date(e.fecha).toLocaleDateString()})]},e.id))})]})]}):(0,n.jsx)("div",{className:"rounded-2xl border border-dashed border-botanical-200 bg-white p-6 text-sm text-botanical-600",children:"Selecciona un lead para ver detalles."})}function r(e){let{searchValue:a,onSearchChange:t,statusValue:s,onStatusChange:o,countryValue:l,onCountryChange:i,countries:d}=e;return(0,n.jsxs)("div",{className:"flex flex-col gap-3 rounded-2xl border border-botanical-100 bg-white p-4 shadow-sm md:flex-row md:items-center md:justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-botanical-700",children:"Buscar lead"}),(0,n.jsx)("input",{value:a,onChange:e=>t(e.target.value),placeholder:"Nombre o tel\xe9fono",className:"w-full rounded-xl border border-botanical-100 px-3 py-2 text-sm focus:border-botanical-400 focus:outline-none focus:ring-2 focus:ring-botanical-100"})]}),(0,n.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-botanical-700",children:"Estado"}),(0,n.jsxs)("select",{value:s,onChange:e=>o(e.target.value),className:"w-full rounded-xl border border-botanical-100 px-3 py-2 text-sm focus:border-botanical-400 focus:outline-none focus:ring-2 focus:ring-botanical-100",children:[(0,n.jsx)("option",{value:"all",children:"Todos"}),(0,n.jsx)("option",{value:"nuevo",children:"Nuevo"}),(0,n.jsx)("option",{value:"contactado",children:"Contactado"}),(0,n.jsx)("option",{value:"seguimiento",children:"En seguimiento"}),(0,n.jsx)("option",{value:"llamada",children:"Llamada realizada"}),(0,n.jsx)("option",{value:"venta",children:"Venta efectiva"}),(0,n.jsx)("option",{value:"no_interesado",children:"No interesado"}),(0,n.jsx)("option",{value:"cerrado_tiempo",children:"Cerrado por tiempo"})]})]}),(0,n.jsxs)("div",{className:"flex flex-1 flex-col gap-2",children:[(0,n.jsx)("label",{className:"text-xs font-semibold text-botanical-700",children:"Pa\xeds"}),(0,n.jsxs)("select",{value:l,onChange:e=>i(e.target.value),className:"w-full rounded-xl border border-botanical-100 px-3 py-2 text-sm focus:border-botanical-400 focus:outline-none focus:ring-2 focus:ring-botanical-100",children:[(0,n.jsx)("option",{value:"all",children:"Todos"}),d.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]})]})}function c(e){let{leads:a,selectedLeadId:t,onSelect:s}=e,o=e=>{let a=Math.floor((Date.now()-new Date(e).getTime())/864e5);return{remaining:Math.max(0,5-a),isBreached:a>5}};return(0,n.jsx)("div",{className:"overflow-hidden rounded-2xl border border-botanical-100 bg-white shadow-sm",children:(0,n.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,n.jsx)("thead",{className:"bg-botanical-50 text-xs uppercase tracking-[0.08em] text-botanical-600",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3",children:"Lead"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"Pa\xeds"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"Estado"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"Tel\xe9fono"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"Agente"})]})}),(0,n.jsx)("tbody",{children:a.map(e=>{var a;return(0,n.jsxs)("tr",{className:"cursor-pointer border-t border-botanical-100 transition hover:bg-botanical-50/70 ".concat(t===e.id?"bg-botanical-50":"bg-white"),onClick:()=>s(e.id),children:[(0,n.jsxs)("td",{className:"px-4 py-3 font-semibold text-botanical-900",children:[null!==(a=e.nombre)&&void 0!==a?a:"Sin nombre",(0,n.jsxs)("p",{className:"text-xs font-normal text-botanical-600",children:["ID ",e.id.slice(0,6),"..."]}),(0,n.jsxs)("p",{className:"text-xs font-semibold ".concat(o(e.createdAt).isBreached?"text-rose-600":"text-botanical-600"),children:["SLA: ",o(e.createdAt).isBreached?"Vencido":"".concat(o(e.createdAt).remaining," d\xedas")]})]}),(0,n.jsx)("td",{className:"px-4 py-3 text-botanical-700",children:e.pais}),(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsx)(i,{status:e.estadoActual})}),(0,n.jsx)("td",{className:"px-4 py-3 text-botanical-700",children:e.telefono}),(0,n.jsx)("td",{className:"px-4 py-3 text-botanical-700",children:e.agenteId})]},e.id)})})]})})}let x=[{id:"lead-001",nombre:"Mar\xeda Torres",telefono:"+57 300 123 4567",pais:"Colombia",administradorId:"admin-co",agenteId:"agente-co-01",estadoActual:"nuevo",fechaEstado:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"lead-002",nombre:"Jos\xe9 Mart\xednez",telefono:"+52 55 2345 6789",pais:"M\xe9xico",administradorId:"admin-mx",agenteId:"agente-mx-03",estadoActual:"seguimiento",fechaEstado:new Date(Date.now()-864e5).toISOString(),createdAt:new Date(Date.now()-1728e5).toISOString(),updatedAt:new Date().toISOString()},{id:"lead-003",nombre:"Carolina R\xedos",telefono:"+56 9 8123 4567",pais:"Chile",administradorId:"admin-cl",agenteId:"agente-cl-02",estadoActual:"contactado",fechaEstado:new Date(Date.now()-18e6).toISOString(),createdAt:new Date(Date.now()-1728e5).toISOString(),updatedAt:new Date().toISOString()},{id:"lead-004",nombre:"Daniel Herrera",telefono:"+51 999 888 777",pais:"Per\xfa",administradorId:"admin-pe",agenteId:"agente-pe-05",estadoActual:"llamada",fechaEstado:new Date(Date.now()-18e5).toISOString(),createdAt:new Date(Date.now()-432e5).toISOString(),updatedAt:new Date().toISOString()},{id:"lead-005",nombre:"Sof\xeda L\xf3pez",telefono:"+54 11 5678 9012",pais:"Argentina",administradorId:"admin-ar",agenteId:"agente-ar-01",estadoActual:"venta",fechaEstado:new Date(Date.now()-216e5).toISOString(),createdAt:new Date(Date.now()-2592e5).toISOString(),updatedAt:new Date().toISOString()}],m=x.map((e,a)=>({id:"history-".concat(a+1),leadId:e.id,estado:e.estadoActual,fecha:e.fechaEstado,usuarioId:e.agenteId})),u=async()=>{let e=Date.now();return x.forEach(a=>{(e-new Date(a.createdAt).getTime())/864e5>5&&"venta"!==a.estadoActual&&"cerrado_tiempo"!==a.estadoActual&&(a.estadoActual="cerrado_tiempo",a.fechaEstado=new Date().toISOString(),a.updatedAt=new Date().toISOString(),m.push({id:"history-".concat(m.length+1),leadId:a.id,estado:"cerrado_tiempo",fecha:a.fechaEstado,usuarioId:"sistema"}))}),[...x]},h=async(e,a)=>{let t=x.find(a=>a.id===e);if(!t)throw Error("Lead no encontrado");return t.estadoActual=a,t.fechaEstado=new Date().toISOString(),t.updatedAt=new Date().toISOString(),m.push({id:"history-".concat(m.length+1),leadId:e,estado:a,fecha:t.fechaEstado,usuarioId:t.agenteId}),t},b=async e=>h(e,"venta"),p=async e=>m.filter(a=>a.leadId===e);var g=t(9965),f=t(4988);let j=["Llamada efectiva. Cliente interesado.","No contest\xf3. Reagendar seguimiento.","Cliente solicita m\xe1s informaci\xf3n.","N\xfamero incorrecto."];function v(){let[e,a]=(0,s.useState)([]),[t,o]=(0,s.useState)(null),[l,i]=(0,s.useState)(""),[x,m]=(0,s.useState)("all"),[v,w]=(0,s.useState)("all"),[N,S]=(0,s.useState)(null),[D,A]=(0,s.useState)([]),[I,y]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{let e=await u();a(e),e.length>0&&o(e[0].id)})()},[]),(0,s.useEffect)(()=>{(async()=>{t&&A(await p(t))})()},[t]);let C=(0,s.useMemo)(()=>Array.from(new Set(e.map(e=>e.pais))).sort(),[e]),O=(0,s.useMemo)(()=>e.filter(e=>{var a;let t=(null===(a=e.nombre)||void 0===a?void 0:a.toLowerCase().includes(l.toLowerCase()))||e.telefono.toLowerCase().includes(l.toLowerCase()),n="all"===x||e.estadoActual===x,s="all"===v||e.pais===v;return t&&n&&s}),[e,l,x,v]),_=(0,s.useMemo)(()=>{var a;return null!==(a=e.find(e=>e.id===t))&&void 0!==a?a:null},[e,t]),E=async e=>{if(!_)return;if(y(null),"venta"===e&&0===(await (0,g.dY)(_.id)).length){y("No se puede cerrar sin llamada registrada.");return}let t=await h(_.id,e);a(e=>e.map(e=>e.id===t.id?t:e)),A(await p(t.id)),await (0,f.N)("lead_status_change","lead",t.id,"Estado actualizado a ".concat(e),"Agente")},L=async()=>{if(!_)return;if(y(null),0===(await (0,g.dY)(_.id)).length){y("No se puede cerrar sin llamada registrada.");return}let e=await b(_.id);a(a=>a.map(a=>a.id===e.id?e:a)),A(await p(e.id)),await (0,f.N)("lead_status_change","lead",e.id,"Lead cerrado como venta efectiva","Agente")},M=_?Math.max(0,5-Math.floor((Date.now()-new Date(_.createdAt).getTime())/864e5)):0,k=!!_&&Date.now()-new Date(_.createdAt).getTime()>432e6;return(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold text-botanical-900",children:"Leads"}),(0,n.jsx)("p",{className:"text-sm text-botanical-600",children:"Gesti\xf3n centralizada de leads con estados y seguimiento."})]}),(0,n.jsx)(r,{searchValue:l,onSearchChange:i,statusValue:x,onStatusChange:m,countryValue:v,onCountryChange:w,countries:C}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1.6fr_1fr]",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-botanical-500",children:"Leads activos"}),0===O.length?(0,n.jsx)("div",{className:"rounded-2xl border border-dashed border-botanical-200 bg-white p-6 text-sm text-botanical-600",children:"No hay leads para los filtros actuales."}):(0,n.jsx)(c,{leads:O,selectedLeadId:t,onSelect:o})]}),(0,n.jsx)(d,{lead:_,onChangeStatus:E,onCloseLead:L,onSimulateCall:()=>{S(j[Math.floor(Math.random()*j.length)]),_&&(0,f.N)("call_result_registered","lead",_.id,"Resultado de llamada simulado","Agente")},lastCallNote:N,history:D,slaDaysRemaining:M,isSlaBreached:k,errorMessage:I})]})]})}},4988:(e,a,t)=>{"use strict";t.d(a,{N:()=>s,l:()=>o});let n=[{id:"audit-001",action:"lead_status_change",actor:"Agente CO-01",entityId:"lead-001",entityType:"lead",createdAt:new Date(Date.now()-72e5).toISOString(),summary:"Estado actualizado a Contactado"}],s=async function(e,a,t,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Sistema",l={id:"audit-".concat(Math.random().toString(36).slice(2,7)),action:e,actor:o,entityType:a,entityId:t,summary:s,createdAt:new Date().toISOString()};return n.unshift(l),l},o=async()=>[...n]},9965:(e,a,t)=>{"use strict";t.d(a,{O1:()=>s,dY:()=>o,fj:()=>l});let n=[{id:"call-001",leadId:"lead-001",leadName:"Mar\xeda Torres",leadPhone:"+57 300 123 4567",agentName:"Agente CO-01",startedAt:new Date(Date.now()-3e6).toISOString(),endedAt:new Date(Date.now()-24e5).toISOString(),durationMinutes:10,result:"interesado",notes:"Solicita m\xe1s informaci\xf3n sobre instalaci\xf3n."},{id:"call-002",leadId:"lead-002",leadName:"Jos\xe9 Mart\xednez",leadPhone:"+52 55 2345 6789",agentName:"Agente MX-03",startedAt:new Date(Date.now()-54e5).toISOString(),endedAt:new Date(Date.now()-492e4).toISOString(),durationMinutes:8,result:"no_contesta",notes:"No respondi\xf3, reintentar ma\xf1ana."},{id:"call-003",leadId:"lead-003",leadName:"Carolina R\xedos",leadPhone:"+56 9 8123 4567",agentName:"Agente CL-02",startedAt:new Date(Date.now()-9e6).toISOString(),endedAt:new Date(Date.now()-828e4).toISOString(),durationMinutes:12,result:"venta",notes:"Venta cerrada, enviar garant\xeda."}],s=async()=>[...n],o=async e=>n.filter(a=>a.leadId===e),l=async(e,a,t)=>{let s=n.find(a=>a.id===e);if(!s)throw Error("Llamada no encontrada");return s.result=a,s.notes=t,s.endedAt=new Date().toISOString(),s.durationMinutes=Math.max(1,s.durationMinutes),s}}},e=>{var a=a=>e(e.s=a);e.O(0,[441,684,358],()=>a(727)),_N_E=e.O()}]);